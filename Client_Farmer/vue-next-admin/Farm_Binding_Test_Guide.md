# 农场绑定和图片上传功能测试指南

## 📋 功能概述

本指南用于测试新重构的农场绑定功能，该功能现在支持：
- 使用文件上传组件代替URL输入框
- 先创建农场，再上传图片的两步流程
- Logo和农场图片的分别上传

## 🔧 更新内容

### 1. API接口更新
- **新增**: `addFarmPic()` - 上传农场图片
- **新增**: `addFarmMainPic()` - 上传农场Logo
- **更新**: `BindFarmResponse` - 新增 `farm_id` 返回字段

### 2. UI界面更新
- **Logo上传**: 文件上传组件，限制1张，最大10MB
- **农场图片**: 文件上传组件，限制5张，最大10MB
- **表单验证**: 移除对Logo URL的依赖

### 3. 业务流程更新
```
旧流程: 填写表单(包含图片URL) → 提交绑定
新流程: 填写表单(不含图片) → 绑定农场获取ID → 上传图片
```

## 🧪 测试步骤

### 步骤1: 准备测试环境
1. 确保后端接口已更新，支持返回 `farm_id`
2. 确保后端图片上传接口 `/api/AddFarmPic` 和 `/api/AddFarmMainPic` 可用
3. 准备测试图片文件（JPG/PNG格式，小于10MB）

### 步骤2: 基础绑定测试
1. 访问农场绑定页面 `/tools`
2. 填写必填字段：
   - 农场名称
   - 农场描述  
   - 农场地址
   - 联系电话
3. **不上传任何图片**，点击"确认绑定"
4. 验证：
   - [ ] 绑定成功提示
   - [ ] 控制台显示获取到的 `farm_id`
   - [ ] 页面状态更新为"已绑定"

### 步骤3: Logo上传测试
1. 重新填写农场信息
2. 在"农场Logo"区域上传1张图片
3. 点击"确认绑定"
4. 验证：
   - [ ] 农场绑定成功
   - [ ] Logo上传成功（控制台无错误）
   - [ ] 图片文件正确传递给后端

### 步骤4: 农场图片上传测试
1. 重新填写农场信息
2. 在"农场图片"区域上传2-3张图片
3. 点击"确认绑定"
4. 验证：
   - [ ] 农场绑定成功
   - [ ] 所有农场图片上传成功
   - [ ] 多文件上传逐个执行

### 步骤5: 完整流程测试
1. 重新填写农场信息
2. 上传1张Logo + 3张农场图片
3. 点击"确认绑定"
4. 验证：
   - [ ] 绑定流程完整执行
   - [ ] Logo和农场图片全部上传成功
   - [ ] 错误处理正常（如有图片上传失败）

### 步骤6: 异常场景测试
1. **超大文件测试**: 上传>10MB的图片
   - [ ] 显示文件大小错误提示
2. **错误格式测试**: 上传非图片文件
   - [ ] 显示格式错误提示
3. **网络异常测试**: 断网情况下操作
   - [ ] 显示合适的错误提示
4. **部分失败测试**: 模拟图片上传失败
   - [ ] 农场绑定成功，图片上传失败有警告提示

## 📝 预期结果

### 成功绑定后的表现
1. 页面显示"农场已绑定"状态
2. 控制台日志完整记录：
   ```
   绑定农场响应: {...}
   获取到的农场ID: 123
   开始上传Logo: logo.jpg
   Logo上传成功
   开始上传农场图片，共 3 个文件
   上传农场图片: farm1.jpg
   农场图片 farm1.jpg 上传成功
   ...
   ```
3. 后端接收到正确的FormData：
   - `farm_id`: 数字类型
   - `file`: 文件对象

### API调用序列
```
1. POST /api/bindFarm → 返回 {farm_id: 123}
2. POST /api/AddFarmMainPic (如有Logo)
3. POST /api/AddFarmPic (循环上传农场图片)
4. GET /api/getFarm (刷新农场信息)
```

## 🔍 关键检查点

- [ ] `BindFarmResponse` 中 `farm_id` 字段正确返回
- [ ] 文件上传组件UI正常显示和交互
- [ ] FormData格式正确（farm_id + file）
- [ ] 错误处理机制有效
- [ ] 成功/失败提示准确
- [ ] 页面状态正确更新

## 🚨 常见问题

1. **农场ID未返回**: 检查后端BindFarm接口是否返回farm_id
2. **图片上传失败**: 检查后端图片上传接口和文件大小限制
3. **UI组件异常**: 检查Element Plus版本和样式兼容性
4. **类型错误**: 检查TypeScript接口定义是否正确

## 📞 测试完成后

测试完成后，请记录：
- 所有测试用例的通过情况
- 发现的问题和解决方案
- 性能表现（上传速度、响应时间）
- 用户体验反馈

---

*最后更新: 2024年1月*