import{l as F,Z as H,r as d,M as O,w as Q,A as r,a5 as W,O as R,C as c,H as o,D as t,P as h,Q as Z,B as y,G as J,S as v,F as K,T as X,e as i}from"./.store-B6_YEv0p.js";import{g as Y,a as $,b as ee}from"./category-D-5L-kf2.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-LdrvTkjS.js";const te={class:"category-add-container layout-pd"},ae={class:"mt15"},le={key:0},re=F({name:"productCategoryAdd"}),se=F({...re,setup(ne){const U=H(),u=d(),x=d(!1),C=d(!1),B=d([]),z=d(),w=d([]),p=d(null),n=O({name:"",description:""}),L={name:[{required:!0,message:"请输入类目名称",trigger:"blur"},{min:1,max:50,message:"类目名称长度在1到50个字符",trigger:"blur"}]},I=()=>{n.name="",n.description="",w.value=[],p.value=null,u.value&&u.value.resetFields()},N=a=>{a.raw&&(p.value=a.raw,console.log("选择的图片文件:",a.name))},P=()=>{p.value=null,console.log("移除图片文件")},A=a=>{const e=a.type.startsWith("image/"),l=a.size/1024/1024<5;return e?l?!0:(i.error("图片大小不能超过 5MB!"),!1):(i.error("只能上传图片文件!"),!1)},E=()=>{U.back()},M=async()=>{try{C.value=!0;const a=await Y({categoryType:1});a.code===200?B.value=a.category||[]:i.warning(a.msg||"获取类目列表失败")}catch(a){console.error("获取类目列表失败:",a),i.error("获取类目列表失败，请稍后重试")}finally{C.value=!1}},S=async()=>{if(!(!u.value||!await u.value.validate().catch(()=>!1)))try{x.value=!0;const e={category:{category_id:0,name:n.name.trim(),category_type:1,text:n.description.trim(),image_url:""}};console.log("新增农产品类目请求参数:",e);const l=await $(e);console.log("新增农产品类目响应:",l);const g=l.code||l.Code,b=l.msg||l.Msg,m=l.category_id||l.CategoryID;if(g===200){try{p.value&&m&&(console.log("开始上传类目图片，类目ID:",m),await ee(p.value,m),console.log("类目图片上传成功"))}catch(_){console.error("图片上传失败:",_),i.warning("类目创建成功，但图片上传失败")}i.success("农产品类目新增成功！"),I(),await M()}else{const _=b||"新增农产品类目失败";i.error(_)}}catch(e){console.error("新增农产品类目失败:",e),i.error(e.message||"新增农产品类目失败，请稍后重试")}finally{x.value=!1}};return Q(()=>{M()}),(a,e)=>{const l=r("el-input"),g=r("el-form-item"),b=r("ele-Plus"),m=r("el-icon"),_=r("el-upload"),k=r("el-card"),T=r("el-form"),V=r("el-button"),f=r("el-table-column"),j=r("el-image"),D=r("el-text"),q=r("el-table"),G=W("loading");return c(),R("div",te,[o(k,{shadow:"hover"},{default:t(()=>[e[6]||(e[6]=h("div",{class:"mb15"},"新增农产品类目",-1)),o(T,{ref_key:"formRef",ref:u,model:n,rules:L,"label-width":"110px"},{default:t(()=>[o(k,{class:"mb15",shadow:"never"},{default:t(()=>[o(g,{label:"类目名称",prop:"name"},{default:t(()=>[o(l,{modelValue:n.name,"onUpdate:modelValue":e[0]||(e[0]=s=>n.name=s),placeholder:"请输入类目名称",clearable:"",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(g,{label:"类目描述"},{default:t(()=>[o(l,{modelValue:n.description,"onUpdate:modelValue":e[1]||(e[1]=s=>n.description=s),type:"textarea",rows:3,placeholder:"请输入类目描述（可选）",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(g,{label:"类目图片"},{default:t(()=>[o(_,{ref_key:"imageUploadRef",ref:z,"file-list":w.value,"auto-upload":!1,limit:1,"list-type":"picture-card","on-change":N,"on-remove":P,"before-upload":A,accept:"image/*",class:Z(["category-image-upload",{"hide-upload":w.value.length>0}])},{tip:t(()=>[...e[2]||(e[2]=[h("div",{class:"el-upload__tip"},"只能上传一张类目图片，jpg/png文件，且不超过5MB",-1)])]),default:t(()=>[w.value.length===0?(c(),y(m,{key:0},{default:t(()=>[o(b)]),_:1})):J("",!0)]),_:1},8,["file-list","class"])]),_:1})]),_:1})]),_:1},8,["model"]),h("div",ae,[o(V,{type:"primary",loading:x.value,onClick:S},{default:t(()=>[o(m,null,{default:t(()=>[o(b)]),_:1}),e[3]||(e[3]=v(" 新增类目 ",-1))]),_:1},8,["loading"]),o(V,{onClick:I},{default:t(()=>[...e[4]||(e[4]=[v("重置",-1)])]),_:1}),o(V,{type:"info",onClick:E},{default:t(()=>[...e[5]||(e[5]=[v("返回",-1)])]),_:1})])]),_:1}),o(k,{shadow:"hover",class:"mt15"},{default:t(()=>[e[9]||(e[9]=h("div",{class:"mb15"},"已有农产品类目",-1)),K((c(),y(q,{data:B.value,style:{width:"100%"},border:"",stripe:""},{default:t(()=>[o(f,{type:"index",label:"序号",width:"60",align:"center"}),o(f,{label:"类目图片",width:"100",align:"center"},{default:t(s=>[s.row.image_url?(c(),y(j,{key:0,src:s.row.image_url,fit:"cover",style:{width:"50px",height:"50px","border-radius":"4px"},"preview-src-list":[s.row.image_url]},null,8,["src","preview-src-list"])):(c(),y(D,{key:1,type:"info",size:"small"},{default:t(()=>[...e[7]||(e[7]=[v("暂无图片",-1)])]),_:1}))]),_:1}),o(f,{prop:"name",label:"类目名称","min-width":"120","show-overflow-tooltip":""}),o(f,{prop:"text",label:"类目描述","min-width":"160","show-overflow-tooltip":""},{default:t(s=>[s.row.text?(c(),R("span",le,X(s.row.text),1)):(c(),y(D,{key:1,type:"info",size:"small"},{default:t(()=>[...e[8]||(e[8]=[v("暂无描述",-1)])]),_:1}))]),_:1}),o(f,{prop:"category_id",label:"类目ID",width:"100",align:"center"})]),_:1},8,["data"])),[[G,C.value]])]),_:1})])}}}),ue=oe(se,[["__scopeId","data-v-31c202b7"]]);export{ue as default};
