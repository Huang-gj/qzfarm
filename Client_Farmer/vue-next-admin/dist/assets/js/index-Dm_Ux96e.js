import{a as J}from"./formatTime-in1fXasu.js";import{b as O,S as j}from"./index-Bt6IFO1h.js";import{u as W,a as K,g as Q,b as X,c as Y}from"./auth-CwQKj0Jg.js";import{l as N,M as k,p as C,w as Z,x as ee,A as v,O as y,C as F,P as s,H as a,D as l,S as h,T as w,$ as ae,a0 as le,G as se,e as r}from"./.store-D3f7YvtR.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const te=[{title:"[开发] 2025年08月19日提交 v3.2.0 版本",date:"2025/8/19",link:"https://github.com/Huang-gj/qzfarm"},{title:"[开发] 2025年08月18日提交 v3.1.0 v3.1.1 版本",date:"2025/8/18",link:"https://github.com/Huang-gj/qzfarm"},{title:"[开发] 2025年08月14日提交 v2.3.0 版本",date:"2025/8/14",link:"https://github.com/Huang-gj/qzfarm"},{title:"[开发] 2025年08月13日提交 v2.1.1 v2.1.2 v2.2.0 v2.2.1 版本",date:"2025/8/13",link:"https://github.com/Huang-gj/qzfarm"},{title:"[开发] 2025年08月12日提交 v2.1.0 版本",date:"2025/8/12",link:"https://github.com/Huang-gj/qzfarm"},{title:"[开发] 2025年08月12日提交 v1.9.0 版本",date:"2025/8/12",link:"https://github.com/Huang-gj/qzfarm"},{title:"[开发] 2025年08月09日提交 v1.8.1 版本",date:"2025/8/9",link:"https://github.com/Huang-gj/qzfarm"},{title:"[开发] 2025年08月09日提交 v1.8.0 版本",date:"2025/8/9",link:"https://github.com/Huang-gj/qzfarm"},{title:"[开发] 2025年08月08日提交 v1.7.0 版本",date:"2025/8/8",link:"https://github.com/Huang-gj/qzfarm"},{title:"[开发] 2025年08月07日提交 v1.6.0 版本",date:"2025/8/7",link:"https://github.com/Huang-gj/qzfarm"},{title:"[开发] 2025年08月06日提交 v1.5.0 版本",date:"2025/8/6",link:"https://github.com/Huang-gj/qzfarm"},{title:"[开发] 2025年08月05日提交 v1.4.0 版本",date:"2025/8/5",link:"https://github.com/Huang-gj/qzfarm"},{title:"[开发] 2025年08月04日提交 v1.3.0 版本",date:"2025/8/4",link:"https://github.com/Huang-gj/qzfarm"},{title:"[开发] 2025年07月31日提交 v1.2.0 v1.2.1 版本",date:"2025/7/31",link:"https://github.com/Huang-gj/qzfarm"},{title:"[开发] 2025年07月30日提交 v1.1.0 v1.1.1 版本",date:"2025/7/30",link:"https://github.com/Huang-gj/qzfarm"},{title:"[开发] 2025年07月29日提交 v1.0.1 版本",date:"2025/7/29",link:"https://github.com/Huang-gj/qzfarm"},{title:"[开发] 2025年07月28日提交 v1.0.0 版本",date:"2025/7/28",link:"https://github.com/Huang-gj/qzfarm"}],ne={class:"personal-container"},re={class:"personal layout-pd"},ie={class:"personal-content"},de={class:"personal-user"},me={class:"personal-user-left"},ue={class:"h100 personal-user-left-upload"},pe=["src"],fe={class:"avatar-upload-overlay"},ce={class:"personal-user-right"},ve={class:"personal-item-value"},_e={class:"personal-item-value"},ge={class:"personal-item-value"},we={class:"personal-item-value"},be={class:"personal-info-box"},he={class:"personal-info-ul"},Ve=["href"],Pe={key:0,class:"mt5",style:{"font-size":"12px",color:"var(--el-color-warning)"}},ke={class:"personal-edit-safe-box"},xe={class:"personal-edit-safe-item"},qe={class:"personal-edit-safe-item-right"},ye={class:"personal-edit-safe-box"},Fe={class:"personal-edit-safe-item"},De={class:"personal-edit-safe-item-left"},Ue={class:"personal-edit-safe-item-left-value"},ze={class:"personal-edit-safe-item-right"},Ie={class:"dialog-footer"},He={class:"dialog-footer"},je=N({name:"personal"}),Ce=N({...je,setup(Ne){const x=O(),n=k({newsInfoList:te,recommendList:[],personalForm:{admin_id:"",nickname:"",phone_number:"",qq_email:"",avatar:"",role:"超级管理"},avatarFile:null,avatarPreview:""}),g=k({value:!1}),p=k({passwordDialogVisible:!1,phoneDialogVisible:!1}),i=k({oldPassword:"",newPassword:"",confirmPassword:""}),u=k({newPhoneNumber:"",password:""}),m=C(()=>x.getUserInfo||{admin_id:0,phone_number:"",avatar:"",nickname:"",qq_email:"",gender:0,farm_id:0}),A=C(()=>J(new Date)),z=()=>{var o;m.value&&(n.personalForm={admin_id:((o=m.value.admin_id)==null?void 0:o.toString())||"",nickname:m.value.nickname||"",phone_number:m.value.phone_number||"",qq_email:m.value.qq_email||"",avatar:m.value.avatar||"",role:"超级管理"},n.avatarFile=null,n.avatarPreview="")};Z(()=>{z()}),ee(()=>{p.passwordDialogVisible=!1,p.phoneDialogVisible=!1,i.oldPassword="",i.newPassword="",i.confirmPassword="",u.newPhoneNumber="",u.password="",g.value=!1});const L=o=>!o||o.length!==11?"未设置":o.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"),S=async()=>{try{g.value=!0;const o=m.value;if(n.avatarFile)try{const f=await W(n.avatarFile,o.admin_id);if(f.code===200)r.success("头像更新成功"),n.avatarFile=null,n.avatarPreview="";else{r.error(f.msg||"头像上传失败");return}}catch(f){console.error("头像上传失败:",f),r.error("头像上传失败，请重试");return}const e={admin_id:parseInt(n.personalForm.admin_id)||o.admin_id,nickname:n.personalForm.nickname||o.nickname||"",qq_email:n.personalForm.qq_email||o.qq_email||"",gender:o.gender||0},b=await K(e);if(b.code===200){r.success("个人信息更新成功");const f=await Q({admin_id:e.admin_id});f.code===200?(x.updateUserInfo(f.admin),z(),r.success("用户信息已刷新")):r.error("获取最新用户信息失败")}else r.error(b.msg||"更新失败")}catch(o){console.error("更新个人信息失败:",o),r.error("更新个人信息失败，请重试")}finally{g.value=!1}},M=()=>{p.passwordDialogVisible=!0,i.oldPassword="",i.newPassword="",i.confirmPassword=""},$=()=>{p.phoneDialogVisible=!0,u.newPhoneNumber="",u.password=""},B=async()=>{try{if(!i.oldPassword){r.error("请输入原密码");return}if(!i.newPassword){r.error("请输入新密码");return}if(!i.confirmPassword){r.error("请确认新密码");return}if(i.newPassword!==i.confirmPassword){r.error("两次输入的密码不一致");return}g.value=!0;const o=await X({admin_id:m.value.admin_id,password:i.newPassword});o.code===200?(r.success("密码修改成功，请重新登录"),p.passwordDialogVisible=!1,x.clearUserInfo(),j.clear(),window.location.href="/login"):r.error(o.msg||"密码修改失败")}catch(o){console.error("修改密码失败:",o),r.error("修改密码失败，请重试")}finally{g.value=!1}},R=async()=>{try{if(!u.newPhoneNumber){r.error("请输入新手机号");return}if(!u.password){r.error("请输入密码");return}if(!/^1[3-9]\d{9}$/.test(u.newPhoneNumber)){r.error("请输入正确的手机号格式");return}g.value=!0;const o=await Y({admin_id:m.value.admin_id,phone_number:u.newPhoneNumber,password:u.password});o.code===200?(r.success("手机号修改成功，请重新登录"),p.phoneDialogVisible=!1,x.clearUserInfo(),j.clear(),window.location.href="/login"):r.error(o.msg||"手机号修改失败")}catch(o){console.error("修改手机号失败:",o),r.error("修改手机号失败，请重试")}finally{g.value=!1}},I=o=>o.type.startsWith("image/")?o.size/1024/1024<5?!0:(r.error("图片大小不能超过 5MB!"),!1):(r.error("只能上传图片文件!"),!1),E=o=>{if(!o.raw||!I(o.raw))return;n.avatarFile=o.raw;const b=new FileReader;b.onload=f=>{var q;n.avatarPreview=(q=f.target)==null?void 0:q.result},b.readAsDataURL(o.raw),r.success('头像已选择，点击"更新个人信息"按钮完成更新')};return(o,e)=>{const b=v("ele-Camera"),f=v("el-icon"),q=v("el-upload"),d=v("el-col"),P=v("el-row"),D=v("el-card"),_=v("el-input"),c=v("el-form-item"),T=v("ele-Position"),V=v("el-button"),U=v("el-form"),H=v("el-dialog");return F(),y("div",ne,[s("div",re,[s("div",ie,[a(P,null,{default:l(()=>[a(d,{xs:24,sm:16},{default:l(()=>[a(D,{shadow:"hover",header:"个人信息"},{default:l(()=>[s("div",de,[s("div",me,[s("div",ue,[a(q,{class:"avatar-uploader","show-file-list":!1,"on-change":E,"before-upload":I,"auto-upload":!1,accept:"image/*"},{default:l(()=>[s("img",{src:n.avatarPreview||m.value.avatar||"https://img2.baidu.com/it/u=1978192862,2048448374&fm=253&fmt=auto&app=138&f=JPEG?w=504&h=500"},null,8,pe),s("div",fe,[a(f,{class:"avatar-upload-icon"},{default:l(()=>[a(b)]),_:1}),e[15]||(e[15]=s("div",{class:"avatar-upload-text"},"更换头像",-1))])]),_:1})])]),s("div",ce,[a(P,null,{default:l(()=>[a(d,{span:24,class:"personal-title mb18"},{default:l(()=>[h(w(A.value)+"，"+w(m.value.nickname||"用户")+"，欢迎使用智慧管理系统！",1)]),_:1}),a(d,{span:24},{default:l(()=>[a(P,null,{default:l(()=>[a(d,{xs:24,sm:8,class:"personal-item mb6"},{default:l(()=>[e[16]||(e[16]=s("div",{class:"personal-item-label"},"管理员ID：",-1)),s("div",ve,w(m.value.admin_id||"未知"),1)]),_:1}),a(d,{xs:24,sm:16,class:"personal-item mb6"},{default:l(()=>[...e[17]||(e[17]=[s("div",{class:"personal-item-label"},"身份：",-1),s("div",{class:"personal-item-value"},"超级管理",-1)])]),_:1})]),_:1})]),_:1}),a(d,{span:24},{default:l(()=>[a(P,null,{default:l(()=>[a(d,{xs:24,sm:8,class:"personal-item mb6"},{default:l(()=>[e[18]||(e[18]=s("div",{class:"personal-item-label"},"昵称：",-1)),s("div",_e,w(m.value.nickname||"未设置"),1)]),_:1}),a(d,{xs:24,sm:16,class:"personal-item mb6"},{default:l(()=>[e[19]||(e[19]=s("div",{class:"personal-item-label"},"手机号：",-1)),s("div",ge,w(m.value.phone_number||"未设置"),1)]),_:1})]),_:1})]),_:1}),a(d,{span:24},{default:l(()=>[a(P,null,{default:l(()=>[a(d,{xs:24,sm:24,class:"personal-item mb6"},{default:l(()=>[e[20]||(e[20]=s("div",{class:"personal-item-label"},"邮箱：",-1)),s("div",we,w(m.value.qq_email||"未设置"),1)]),_:1})]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1}),a(d,{xs:24,sm:8,class:"pl15 personal-info"},{default:l(()=>[a(D,{shadow:"hover"},{header:l(()=>[...e[21]||(e[21]=[s("span",null,"消息通知",-1)])]),default:l(()=>[s("div",be,[s("ul",he,[(F(!0),y(ae,null,le(n.newsInfoList,(t,G)=>(F(),y("li",{key:G,class:"personal-info-li"},[s("a",{href:t.link,target:"_block",class:"personal-info-li-title"},w(t.title),9,Ve)]))),128))])])]),_:1})]),_:1}),a(d,{span:24},{default:l(()=>[a(D,{shadow:"hover",class:"mt15 personal-edit",header:"更新信息"},{default:l(()=>[e[26]||(e[26]=s("div",{class:"personal-edit-title"},"基本信息",-1)),a(U,{model:n.personalForm,size:"default","label-width":"40px",class:"mt35 mb35"},{default:l(()=>[a(P,{gutter:35},{default:l(()=>[a(d,{xs:24,sm:12,md:8,lg:6,xl:4,class:"mb20"},{default:l(()=>[a(c,{label:"ID"},{default:l(()=>[a(_,{modelValue:n.personalForm.admin_id,"onUpdate:modelValue":e[0]||(e[0]=t=>n.personalForm.admin_id=t),placeholder:"ID",disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),a(d,{xs:24,sm:12,md:8,lg:6,xl:4,class:"mb20"},{default:l(()=>[a(c,{label:"昵称"},{default:l(()=>[a(_,{modelValue:n.personalForm.nickname,"onUpdate:modelValue":e[1]||(e[1]=t=>n.personalForm.nickname=t),placeholder:"请输入昵称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(d,{xs:24,sm:12,md:8,lg:6,xl:4,class:"mb20"},{default:l(()=>[a(c,{label:"手机"},{default:l(()=>[a(_,{modelValue:n.personalForm.phone_number,"onUpdate:modelValue":e[2]||(e[2]=t=>n.personalForm.phone_number=t),placeholder:"手机号",disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),a(d,{xs:24,sm:12,md:8,lg:6,xl:4,class:"mb20"},{default:l(()=>[a(c,{label:"邮箱"},{default:l(()=>[a(_,{modelValue:n.personalForm.qq_email,"onUpdate:modelValue":e[3]||(e[3]=t=>n.personalForm.qq_email=t),placeholder:"请输入邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(d,{xs:24,sm:12,md:8,lg:6,xl:4,class:"mb20"},{default:l(()=>[a(c,{label:"头像"},{default:l(()=>[a(_,{modelValue:n.personalForm.avatar,"onUpdate:modelValue":e[4]||(e[4]=t=>n.personalForm.avatar=t),placeholder:"点击左侧头像进行更换",disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),a(d,{xs:24,sm:12,md:8,lg:6,xl:4,class:"mb20"},{default:l(()=>[a(c,{label:"身份"},{default:l(()=>[a(_,{modelValue:n.personalForm.role,"onUpdate:modelValue":e[5]||(e[5]=t=>n.personalForm.role=t),placeholder:"超级管理",disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),a(d,{xs:24,sm:24,md:24,lg:24,xl:24},{default:l(()=>[a(c,null,{default:l(()=>[a(V,{type:"primary",onClick:S,loading:g.value},{default:l(()=>[a(f,null,{default:l(()=>[a(T)]),_:1}),h(" "+w(n.avatarFile?"更新个人信息和头像":"更新个人信息"),1)]),_:1},8,["loading"]),n.avatarFile?(F(),y("div",Pe," 已选择新头像，点击按钮将同时更新头像和个人信息 ")):se("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),e[27]||(e[27]=s("div",{class:"personal-edit-title mb15"},"账号安全",-1)),s("div",ke,[s("div",xe,[e[23]||(e[23]=s("div",{class:"personal-edit-safe-item-left"},[s("div",{class:"personal-edit-safe-item-left-label"},"账户密码"),s("div",{class:"personal-edit-safe-item-left-value"},"已设置")],-1)),s("div",qe,[a(V,{text:"",type:"primary",onClick:M},{default:l(()=>[...e[22]||(e[22]=[h("立即修改",-1)])]),_:1})])])]),s("div",ye,[s("div",Fe,[s("div",De,[e[24]||(e[24]=s("div",{class:"personal-edit-safe-item-left-label"},"密保手机",-1)),s("div",Ue,"已绑定手机："+w(L(m.value.phone_number)),1)]),s("div",ze,[a(V,{text:"",type:"primary",onClick:$},{default:l(()=>[...e[25]||(e[25]=[h("立即修改",-1)])]),_:1})])])])]),_:1})]),_:1})]),_:1})])]),a(H,{modelValue:p.passwordDialogVisible,"onUpdate:modelValue":e[10]||(e[10]=t=>p.passwordDialogVisible=t),title:"修改密码",width:"400px","close-on-click-modal":!1},{footer:l(()=>[s("span",Ie,[a(V,{onClick:e[9]||(e[9]=t=>p.passwordDialogVisible=!1)},{default:l(()=>[...e[28]||(e[28]=[h("取消",-1)])]),_:1}),a(V,{type:"primary",onClick:B,loading:g.value},{default:l(()=>[...e[29]||(e[29]=[h("确认修改",-1)])]),_:1},8,["loading"])])]),default:l(()=>[a(U,{model:i,"label-width":"100px"},{default:l(()=>[a(c,{label:"原密码"},{default:l(()=>[a(_,{modelValue:i.oldPassword,"onUpdate:modelValue":e[6]||(e[6]=t=>i.oldPassword=t),type:"password",placeholder:"请输入原密码","show-password":""},null,8,["modelValue"])]),_:1}),a(c,{label:"新密码"},{default:l(()=>[a(_,{modelValue:i.newPassword,"onUpdate:modelValue":e[7]||(e[7]=t=>i.newPassword=t),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),a(c,{label:"确认密码"},{default:l(()=>[a(_,{modelValue:i.confirmPassword,"onUpdate:modelValue":e[8]||(e[8]=t=>i.confirmPassword=t),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(H,{modelValue:p.phoneDialogVisible,"onUpdate:modelValue":e[14]||(e[14]=t=>p.phoneDialogVisible=t),title:"修改手机号",width:"400px","close-on-click-modal":!1},{footer:l(()=>[s("span",He,[a(V,{onClick:e[13]||(e[13]=t=>p.phoneDialogVisible=!1)},{default:l(()=>[...e[30]||(e[30]=[h("取消",-1)])]),_:1}),a(V,{type:"primary",onClick:R,loading:g.value},{default:l(()=>[...e[31]||(e[31]=[h("确认修改",-1)])]),_:1},8,["loading"])])]),default:l(()=>[a(U,{model:u,"label-width":"100px"},{default:l(()=>[a(c,{label:"新手机号"},{default:l(()=>[a(_,{modelValue:u.newPhoneNumber,"onUpdate:modelValue":e[11]||(e[11]=t=>u.newPhoneNumber=t),placeholder:"请输入新手机号"},null,8,["modelValue"])]),_:1}),a(c,{label:"密码"},{default:l(()=>[a(_,{modelValue:u.password,"onUpdate:modelValue":e[12]||(e[12]=t=>u.password=t),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Be=oe(Ce,[["__scopeId","data-v-d2bdb355"]]);export{Be as default};
