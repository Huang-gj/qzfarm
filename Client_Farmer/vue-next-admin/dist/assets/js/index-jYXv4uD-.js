import{l as B,r as K,Z as P,s as k,M as Q,w as W,_ as X,y as T,n as x,A as w,O as b,C as f,H as u,D as m,$ as O,a0 as L,B as Z,Q as g,P as t,T as y,X as D,e as C,a1 as j,a2 as q,a3 as E}from"./.store-D3f7YvtR.js";import{a as J,u as oo,b as eo,S as ao}from"./index-Bt6IFO1h.js";import{g as so,a as to}from"./farm-CJIwusCT.js";import{_ as lo}from"./_plugin-vue_export-helper-DlAUqK2U.js";const no={class:"home-container layout-pd"},ro=["onClick"],co={class:"flex-auto"},io={class:"font30"},mo={class:"mt10"},ho={class:"card-overlay"},uo={class:"home-card-item"},fo={class:"home-card-item"},go={class:"home-monitor"},_o={class:"flex-warp"},po={class:"flex-margin"},bo={class:"pl5"},yo={class:"mt10"},Co=B({name:"home"}),vo=B({...Co,setup(So){const d=K(),_=P(),R=J(),A=oo(),$=eo(),{themeConfig:I}=k(A),{isTagsViewCurrenFull:M}=k(R),o=Q({global:{homeChartOne:null,homeChartTwo:null,homeCharThree:null,dispose:[null,"",void 0]},homeOne:[{num1:"0",num3:"农产品订单",num4:"fa fa-shopping-cart",color2:"--next-color-primary-lighter",color3:"--el-color-primary"},{num1:"0",num3:"土地订单",num4:"iconfont icon-ditu",color2:"--next-color-success-lighter",color3:"--el-color-success"},{num1:"0",num3:"销售总额",num4:"fa fa-dollar",color2:"--next-color-warning-lighter",color3:"--el-color-warning"},{num1:"0",num3:"系统使用人数",num4:"fa fa-users",color2:"--next-color-danger-lighter",color3:"--el-color-danger"}],homeThree:[{icon:"iconfont icon-yangan",label:"温度监测",value:"25.6℃",iconColor:"#F72B3F"},{icon:"iconfont icon-wendu",label:"湿度监测",value:"65%RH",iconColor:"#91BFF8"},{icon:"iconfont icon-shidu",label:"土壤湿度",value:"78%",iconColor:"#88D565"},{icon:"iconfont icon-shidu",label:"光照强度",value:"45kLux",iconColor:"#88D565"},{icon:"iconfont icon-zaosheng",label:"风速",value:"3.2m/s",iconColor:"#FBD4A0"},{icon:"iconfont icon-zaosheng",label:"降雨量",value:"0mm",iconColor:"#FBD4A0"},{icon:"iconfont icon-zaosheng",label:"pH值",value:"6.8",iconColor:"#FBD4A0"},{icon:"iconfont icon-zaosheng",label:"氮含量",value:"120mg/kg",iconColor:"#FBD4A0"},{icon:"iconfont icon-zaosheng",label:"磷含量",value:"85mg/kg",iconColor:"#FBD4A0"}],myCharts:[],charts:{theme:"",bgColor:"",color:"#303133"},salesData:{months:[],goodSales:[],landSales:[]}}),V=e=>{switch(console.log("点击卡片:",e),e){case 0:_.push("/visualizing/visualizingLinkDemo1");break;case 1:_.push("/visualizing/visualizingLinkDemo2");break;case 2:_.push("/visualizing/salesAnalysis");break;case 3:_.push("/visualizing/userAnalysis");break}},F=()=>{const e=$.getUserInfo,s=ao.get("farmInfo");let a=0;return s!=null&&s.farm_id?a=s.farm_id:e!=null&&e.farm_id&&(a=e.farm_id),console.log("获取农场ID:",a),a},H=async()=>{try{const e=F();if(!e){console.warn("农场ID为空，无法获取总数据");return}console.log("开始获取农场总数据，farm_id:",e);const a=await so({farm_id:e});if(console.log("农场总数据响应:",a),a.code===200){o.homeOne[0].num1=a.good_order_count.toString(),o.homeOne[1].num1=a.sale_order_count.toString();const r=a.good_sale_count+a.land_sale_count;o.homeOne[2].num1=r.toFixed(2),o.homeOne[3].num1=a.sys_use_count.toString(),console.log("数据更新完成")}else console.error("获取农场总数据失败:",a.msg||"未知错误"),C.error(`获取农场数据失败: ${a.msg||"未知错误"}`)}catch(e){console.error("获取农场总数据异常:",e),C.error("获取农场数据失败，请稍后重试")}},Y=async()=>{try{const e=F();if(!e){console.warn("农场ID为空，无法获取销售趋势数据");return}const a=await to({farm_id:e});a.code===200&&a.one_year_sale_data?G(a.one_year_sale_data):(console.error("获取销售趋势数据失败:",a.msg||"未知错误"),C.error(`获取销售趋势数据失败: ${a.msg||"未知错误"}`))}catch(e){console.error("获取销售趋势数据异常:",e),C.error("获取销售趋势数据失败，请稍后重试")}},G=e=>{var n,S;console.log("开始格式化销售数据，原始数据条数:",e.length);const s={};e.forEach(i=>{const c=i.stat_date.substring(0,7);s[c]||(s[c]={good:0,land:0}),s[c].good+=i.good_sale_count,s[c].land+=i.land_sale_count}),console.log("按月聚合后的数据:",s);const a=[],r=[],h=[],l=new Date;for(let i=11;i>=0;i--){const c=new Date(l.getFullYear(),l.getMonth()-i,1),z=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`,U=`${c.getMonth()+1}月`;a.push(U),r.push(((n=s[z])==null?void 0:n.good)||0),h.push(((S=s[z])==null?void 0:S.land)||0)}o.salesData.months=a,o.salesData.goodSales=r,o.salesData.landSales=h,console.log("格式化后的销售数据:",o.salesData),console.log("图表容器元素:",d.value),x(()=>{console.log("准备初始化图表..."),p()})},p=()=>{if(console.log("initLineChart 开始执行"),console.log("homeLineRef.value:",d.value),console.log("当前销售数据:",o.salesData),!d.value){console.error("图表容器未找到，无法初始化图表");return}const e=d.value.getBoundingClientRect();if(console.log("图表容器尺寸:",e),e.width===0||e.height===0){console.warn("图表容器尺寸为0，延迟初始化"),setTimeout(()=>{p()},100);return}o.global.homeChartOne&&!o.global.dispose.some(a=>a===o.global.homeChartOne)&&o.global.homeChartOne.dispose(),o.global.homeChartOne=j(q(d.value,o.charts.theme)),console.log("图表实例创建成功:",o.global.homeChartOne);const s={backgroundColor:o.charts.bgColor,title:{text:"销售额趋势",x:"left",textStyle:{fontSize:"15",color:o.charts.color}},grid:{top:70,right:20,bottom:30,left:30},tooltip:{trigger:"axis"},legend:{data:["农产品销售额","土地销售额"],right:0},xAxis:{data:o.salesData.months.length>0?o.salesData.months:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]},yAxis:[{type:"value",name:"价格",min:0,minInterval:100,interval:200,boundaryGap:[0,"10%"],axisLabel:{formatter:function(a){return a>=1e3?(a/1e3).toFixed(1)+"k":a.toString()}},splitLine:{show:!0,lineStyle:{type:"dashed",color:"#f5f5f5"}}}],series:[{name:"农产品销售额",type:"line",symbolSize:6,symbol:"circle",smooth:!0,data:o.salesData.goodSales.length>0?o.salesData.goodSales:[0,41.1,30.4,65.1,53.3,53.3,53.3,41.1,30.4,65.1,53.3,10],lineStyle:{color:"#fe9a8b"},itemStyle:{color:"#fe9a8b",borderColor:"#fe9a8b"},areaStyle:{color:new E(0,0,0,1,[{offset:0,color:"#fe9a8bb3"},{offset:1,color:"#fe9a8b03"}])}},{name:"土地销售额",type:"line",symbolSize:6,symbol:"circle",smooth:!0,data:o.salesData.landSales.length>0?o.salesData.landSales:[0,24.1,7.2,15.5,42.4,42.4,42.4,24.1,7.2,15.5,42.4,0],lineStyle:{color:"#9E87FF"},itemStyle:{color:"#9E87FF",borderColor:"#9E87FF"},areaStyle:{color:new E(0,0,0,1,[{offset:0,color:"#9E87FFb3"},{offset:1,color:"#9E87FF03"}])},emphasis:{itemStyle:{color:{type:"radial",x:.5,y:.5,r:.5,colorStops:[{offset:0,color:"#9E87FF"},{offset:.4,color:"#9E87FF"},{offset:.5,color:"#fff"},{offset:.7,color:"#fff"},{offset:.8,color:"#fff"},{offset:1,color:"#fff"}]},borderColor:"#9E87FF",borderWidth:2}}}]};console.log("图表配置:",s),o.global.homeChartOne.setOption(s),setTimeout(()=>{o.global.homeChartOne.resize(),console.log("图表resize完成")},100),o.myCharts.push(o.global.homeChartOne),console.log("图表初始化完成")},v=()=>{x(()=>{for(let e=0;e<o.myCharts.length;e++)setTimeout(()=>{o.myCharts[e].resize()},e*1e3)})},N=()=>{window.addEventListener("resize",v)};return W(()=>{N(),H(),Y(),setTimeout(()=>{p()},200)}),X(()=>{v()}),T(()=>M.value,()=>{v()}),T(()=>I.value.isIsDark,e=>{x(()=>{o.charts.theme=e?"dark":"",o.charts.bgColor=e?"transparent":"",o.charts.color=e?"#dadada":"#303133",setTimeout(()=>{p()},500)})},{deep:!0,immediate:!0}),(e,s)=>{const a=w("el-button"),r=w("el-col"),h=w("el-row");return f(),b("div",no,[u(h,{gutter:15,class:"home-card-one mb15"},{default:m(()=>[(f(!0),b(O,null,L(o.homeOne,(l,n)=>(f(),Z(r,{xs:24,sm:12,md:12,lg:6,xl:6,key:n,class:g({"home-media home-media-lg":n>1,"home-media-sm":n===1})},{default:m(()=>[t("div",{class:"home-card-item flex home-card-clickable",onClick:S=>V(n),style:{cursor:"pointer"}},[t("div",{class:g(["flex-margin flex w100",` home-one-animation${n}`])},[t("div",co,[t("span",io,y(l.num1),1),t("div",mo,y(l.num3),1)]),t("div",{class:"home-card-item-icon flex",style:D({background:`var(${l.color2})`})},[t("i",{class:g(["flex-margin font32",l.num4]),style:D({color:`var(${l.color3})`})},null,6)],4)],2),t("div",ho,[u(a,{type:"primary",size:"small",circle:""},{default:m(()=>[...s[0]||(s[0]=[t("i",{class:"fa fa-arrow-right"},null,-1)])]),_:1})])],8,ro)]),_:2},1032,["class"]))),128))]),_:1}),u(h,{gutter:15,class:"home-card-two mb15"},{default:m(()=>[u(r,{xs:24,sm:24,md:24,lg:24,xl:24},{default:m(()=>[t("div",uo,[t("div",{style:{height:"100%"},ref_key:"homeLineRef",ref:d},null,512)])]),_:1})]),_:1}),u(h,{gutter:15,class:"home-card-three"},{default:m(()=>[u(r,{xs:24,sm:24,md:24,lg:24,xl:24},{default:m(()=>[t("div",fo,[s[1]||(s[1]=t("div",{class:"home-card-item-title"},"农业物联网",-1)),t("div",go,[t("div",_o,[(f(!0),b(O,null,L(o.homeThree,(l,n)=>(f(),b("div",{class:"flex-warp-item",key:n},[t("div",{class:g(["flex-warp-item-box",`home-animation${n}`])},[t("div",po,[t("i",{class:g(l.icon),style:D({color:l.iconColor})},null,6),t("span",bo,y(l.label),1),t("div",yo,y(l.value),1)])],2)]))),128))])])])]),_:1})]),_:1})])}}}),zo=lo(vo,[["__scopeId","data-v-329b2f51"]]);export{zo as default};
